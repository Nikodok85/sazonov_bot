from flask import Flask
app = Flask(__name__) 

TOKEN = "8027662725:AAHd6lKQZhaqQp_MqYGhmztUVAcQF24XC3E"
CHANNEL_ID = "@gynekolog_Sazonov"

bot = telebot.TeleBot(TOKEN)
app = Flask(__name__)  # <-- ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž

# ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /start â€” Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ
@bot.message_handler(commands=['start'])
def send_welcome(message):
    markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(telebot.types.KeyboardButton("ðŸŸ¢ Ð—Ð°Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾Ñ"))
    welcome_text = (
        "ÐŸÑ€Ð¸Ð²ÐµÑ‚! ðŸ‘‹\n\n"
        "Ð¢Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ð¾ Ð·Ð°Ð´Ð°Ñ‚ÑŒ Ð»ÑŽÐ±Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð¿Ð¾ Ð³Ð¸Ð½ÐµÐºÐ¾Ð»Ð¾Ð³Ð¸Ð¸.\n\n"
        "ÐÐ°Ð¶Ð¼Ð¸ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ:"
    )
    bot.send_message(message.chat.id, welcome_text, reply_markup=markup)

# ÐÐ°Ð¶Ð°Ñ‚Ð¸Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ "Ð—Ð°Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾Ñ"
@bot.message_handler(func=lambda message: message.text == "ðŸŸ¢ Ð—Ð°Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾Ñ")
def handle_question_prompt(message):
    bot.send_message(
        message.chat.id,
        "âœï¸ ÐÐ°Ð¿Ð¸ÑˆÐ¸ ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ: Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ñƒ ÐµÐ³Ð¾ Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ð¾ Ð¸ Ð¾Ñ‚Ð²ÐµÑ‡Ñƒ Ð² ÐºÐ°Ð½Ð°Ð»Ðµ."
    )

# ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑÑ‚Ð° Ð¸ Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ° Ð² ÐºÐ°Ð½Ð°Ð»
@bot.message_handler(func=lambda message: True, content_types=['text'])
def forward_to_channel(message):
    if message.text != "ðŸŸ¢ Ð—Ð°Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾Ñ":
        bot.send_message(CHANNEL_ID, f"â“ ÐÐ½Ð¾Ð½Ð¸Ð¼Ð½Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ:\n\n{message.text}")
        bot.send_message(message.chat.id, "âœ… Ð’Ð¾Ð¿Ñ€Ð¾Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½! Ð¯ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ñ‚Ð²ÐµÑ‡Ñƒ Ð² ÑÑ‚Ð¾Ð¼ ÐºÐ°Ð½Ð°Ð»Ðµ.")

# Webhook Ð´Ð»Ñ Telegram
@app.route("/" + TOKEN, methods=["POST"])
def webhook():
    json_str = request.get_data().decode("utf-8")
    update = telebot.types.Update.de_json(json_str)
    bot.process_new_updates([update])
    return "OK", 200

# Health check
@app.route("/", methods=["GET"])
def root():
    return "Bot is working", 200

# Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº (Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸)
if __name__ == "__main__":
    app.run()
